<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<title>Insert title here</title>


<!-- jquery script  -->
<script src="jquery-3.2.1.js"></script>

<!-- bootstrap implementation -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">


<!-- jquery datatable stylesheet -->	
<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css"></link>
<!-- jquery datatable javascript -->
<script type="text/javascript" src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>


<script type="text/javascript">

	$(document).ready(function() {




		var table = $('#datatable').DataTable({
			
		
			"processing" : true,
			"serverSide" : true,
			"language": {
				
					"sEmptyTable":   	"Keine Daten in der Tabelle vorhanden",
					"sInfo":         	"_START_ bis _END_ von _TOTAL_ Einträgen",
					"sInfoEmpty":    	"0 bis 0 von 0 Einträgen",
					"sInfoFiltered": 	"(gefiltert von _MAX_ Einträgen)",
					"sInfoPostFix":  	"",
					"sInfoThousands":  	".",
					"sLengthMenu":   	"_MENU_ Einträge anzeigen",
					"sLoadingRecords": 	"Wird geladen...",
					"sProcessing":   	"Bitte warten...",
					"sSearch":       	"<span class=\"glyphicon glyphicon-search\"></span>Suchen",
					"sZeroRecords":  	"Keine Einträge vorhanden.",
					"oPaginate": {
						"sFirst":    	"Erste",
						"sPrevious": 	"Zurück",
						"sNext":     	"Nächste",
						"sLast":     	"Letzte"
					},
					"oAria": {
						"sSortAscending":  ": aktivieren, um Spalte aufsteigend zu sortieren",
						"sSortDescending": ": aktivieren, um Spalte absteigend zu sortieren"
					}
				
			},

			"ajax" : {
			"url" : '/DiplomPdf/DataTableServlet',
			"type" : 'POST',
				"dataSrc": "data"
			},
			
			

			"columns" : [ 
				{"data" : "Name"},
				{"data" : "Autor"},
				{"data" : "UploadDatum"},
				{"data" : "DokumentDatum"},
				{"data" : "Download"},
				{"data" : "Delete"}
			

			],
			

	        "columnDefs": [ {
	        	"targets": -2,
	            "data": "null",
	            "defaultContent": "<button class=\"downloadbutton\">Download!</button>"
	        }, {
	            "targets": -1,
	            "data": "null",
	            "defaultContent": "<button class=\"deletebutton\">Delete!</button>"
	        }  ],

	        

	        
	        
			
			
		    initComplete : function() {		// wird aufgerufen, wenn der DataTable fertig geladen ist
		        var input = $('.dataTables_filter input').off(), //Löscht alle existierenden Listener von der Inputbox
		           self = this.api(),			// referenziert den DataTable in eine Variable, damit er innerhalb der Suchen - Funktion aufgerufen werden kann
		            $searchbutton = $('<button>')	//erstellt ein Buttonobjekt
		                       .html('<p><span class="glyphicon glyphicon-search"/> Suchen</p>')		// Button - Text: Suchen
		                       .click(function() {	//Funktion welche bei drücken des Buttons aufgerufen wird
		                        self.search(input.val()).draw();	//ruft die Search - Funktion des DataTables auf und aktualisiert
		                       }),
		            $deletebutton = $('<button>')	//erstellt ein Buttonobjekt
		                       .html('<p>Löschen<span class="glyphicon glyphicon-remove"></span></p>')		//Button - Text: Löschen
		                       .click(function() {	//Funktion welche bei drücken des Buttons aufgerufen wird
		                          input.val('');	//Setzt den Input wieder leer
		                          $searchbutton.click(); 	//Betätigt die searchbutton - funktion, jetzt jedoch mit leerem Inhalt, zum Aktualisieren
		                       }) 
		        $('.dataTables_filter').append($searchbutton, $deletebutton);	//Fügt beide Buttons zum DataTable hinzu
		    },
			
			

		});

	    $('#datatable tbody').on( 'click', '.downloadbutton', function () {
	    	console.log("downloadbutton geklickt");

	    	var position = $(this);
	    	console.log(position);
	    	

	    	
	         var data = table.row( $(this).parents("tr")).data();
	         var str = JSON.stringify(data);
		     	var xhttp = new XMLHttpRequest();
			
	     	xhttp.open("POST", "DownloadServlet", true);
	    	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	    	xhttp.send("download="+str);
	         

	    	
	    });
	    
	    $("#datatable tbody").on("click",".deletebutton",function(){
	    	alert("gelöscht");
	         var data = table.row( $(this).parents("tr")).data();
	         var str = JSON.stringify(data);
	     	var xhttp = new XMLHttpRequest();
	    	xhttp.open("POST","DeleteServlet",true);
	    	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	    	xhttp.send("todelete="+str);
	    	table.draw();
	    });
		
	    
		
	});
	



	
</script>

</head>
<body>

	<div class="container">
		<div class="row">Hier steht oben noch etwas</div>
		<div class="row">
			<div class="col-sm-2"></div>
			<div class="col-sm-8">
				<table id="datatable">
					<thead>
						<tr>
							<th>Name</th>
							<th>Autor</th>
							<th>UploadDatum</th>
							<th>DokumentDatum</th>
							<th>Download</th>
							<th>Delete</th>
						</tr>

					</thead>
					<tbody>

					</tbody>
				</table>
			</div>
			<div class="col-sm-2"></div>
		</div>

	</div>




</body>
</html>