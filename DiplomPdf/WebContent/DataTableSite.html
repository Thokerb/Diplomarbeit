<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"/>

<title>Insert title here</title>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>


<link rel="stylesheet" href="stylesheet.css"></link>

<!-- jquery datatable stylesheet bootstrap -->	
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.min.css"></link>


</head>
<body>

<!-- jquery script  -->
<script src="jquery-3.2.1.js"></script>

<!-- bootstrap implementation -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<!-- jquery datatable javascript -->
<script type="text/javascript" src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>


<script type="text/javascript">

	$(document).ready(function() {

		//aktiviert Tooltip
	    $('[data-toggle="tooltip"]').tooltip(); 
        
        var table2 = $("#datatable2").DataTable({
            "processing" : true,
			"serverSide" : true,
            "ajax" : {
			"url" : '/DiplomPdf/DataTableServlet',
			"type" : 'POST',
				"dataSrc": "data"
			},
			
			"language": {
				
				"sEmptyTable":   	"Keine Daten in der Tabelle vorhanden",
				"sInfo":         	"_START_ bis _END_ von _TOTAL_ Einträgen",
				"sInfoEmpty":    	"0 bis 0 von 0 Einträgen",
				"sInfoFiltered": 	"(gefiltert von _MAX_ Einträgen)",
				"sInfoPostFix":  	"",
				"sInfoThousands":  	".",
				"sLengthMenu":   	"_MENU_",
				"sLoadingRecords": 	"Wird geladen...",
				"sProcessing":   	"Bitte warten...",
				"sSearch":       	"<span class=\"glyphicon glyphicon-search\"></span>",
				"sZeroRecords":  	"Keine Einträge vorhanden.",
				"oPaginate": {
					"sFirst":    	"Erste",
					"sPrevious": 	"<span class=\"glyphicon glyphicon-circle-arrow-left arrowpagenav\" data-toggle=\"tooltip\" title =\"Vorherige Seite\"></span>",
					"sNext":     	"<span class=\"glyphicon glyphicon-circle-arrow-right arrowpagenav\" data-toggle=\"tooltip\" title =\"Nächste Seite\"></span>",
					"sLast":     	"Letzte"    
				},
				"oAria": {
					"sSortAscending":  ": aktivieren, um Spalte aufsteigend zu sortieren",
					"sSortDescending": ": aktivieren, um Spalte absteigend zu sortieren"
				}
			
		},
            
			"columns" : [ 
				{"data" : "Name"},
				{"data" : "Autor"},
				{"data" : "UploadDatum"},
				{"data" : "DokumentDatum"},
				{"data" : "Download"},
				{"data" : "Delete"}
			

			],
			

	        "columnDefs": [ {
	        	"targets": -2,
	            "data": "null",
	            "defaultContent": "<button class=\"downloadbutton btn-link btn-datatable\" data-toggle=\"tooltip\" title =\"Hier klicken zum Downloaden\"><span class=\"glyphicon glyphicon-arrow-down\" ></span></button>"
	        }, {
	            "targets": -1,
	            "data": "null",
	            "defaultContent": "<button class=\"deletebutton btn-link btn-datatable\" data-toggle=\"tooltip\" title =\"Hier klicken zum Löschen\"><span class=\"glyphicon glyphicon-remove\" ></span></button>"
	        }  ],   
	        
	        
		    initComplete : function() {		// wird aufgerufen, wenn der DataTable fertig geladen ist
		        var input = $('#datatable2_wrapper .dataTables_filter input').off(), //Löscht alle existierenden Listener von der Inputbox
		           self = this.api(),			// referenziert den DataTable in eine Variable, damit er innerhalb der Suchen - Funktion aufgerufen werden kann
		            $searchbutton = $('<button class=\"btn-success dttopbtn\" data-toggle=\"tooltip\" title =\"Suchen\">')	//erstellt ein Buttonobjekt
		                       .html('<span class="glyphicon glyphicon-search"/>')		// Button - Text: Suchen
		                       .click(function() {	//Funktion welche bei drücken des Buttons aufgerufen wird
		                        self.search(input.val()).draw();	//ruft die Search - Funktion des DataTables auf und aktualisiert
		                       }),
		            $deletebutton = $('<button class=\"btn-danger dttopbtn\"data-toggle=\"tooltip\" title =\"Löschen\">')	//erstellt ein Buttonobjekt
		                       .html('<span class="glyphicon glyphicon-remove"></span>')		//Button - Text: Löschen
		                       .click(function() {	//Funktion welche bei drücken des Buttons aufgerufen wird
		                          input.val('');	//Setzt den Input wieder leer
		                          $searchbutton.click(); 	//Betätigt die searchbutton - funktion, jetzt jedoch mit leerem Inhalt, zum Aktualisieren
		                       }) 
		        $('#datatable2_wrapper .dataTables_filter').append($searchbutton, $deletebutton);	//Fügt beide Buttons zum DataTable hinzu
		    },
            
            
        });
        

		var table = $('#datatable').DataTable({
			
		
			"processing" : true,
			"serverSide" : true,
            "ajax" : {
			"url" : '/DiplomPdf/DataTableServlet',
			"type" : 'POST',
				"dataSrc": "data"
			},
            
            
            
			"language": {
				
					"sEmptyTable":   	"Keine Daten in der Tabelle vorhanden",
					"sInfo":         	"_START_ bis _END_ von _TOTAL_ Einträgen",
					"sInfoEmpty":    	"0 bis 0 von 0 Einträgen",
					"sInfoFiltered": 	"(gefiltert von _MAX_ Einträgen)",
					"sInfoPostFix":  	"",
					"sInfoThousands":  	".",
					"sLengthMenu":   	"_MENU_",
					"sLoadingRecords": 	"Wird geladen...",
					"sProcessing":   	"Bitte warten...",
					"sSearch":       	"<span class=\"glyphicon glyphicon-search\"></span>",
					"sZeroRecords":  	"Keine Einträge vorhanden.",
					"oPaginate": {
						"sFirst":    	"Erste",
						"sPrevious": 	"<span class=\"glyphicon glyphicon-circle-arrow-left arrowpagenav\" data-toggle=\"tooltip\" title =\"Vorherige Seite\"></span>",
						"sNext":     	"<span class=\"glyphicon glyphicon-circle-arrow-right arrowpagenav\" data-toggle=\"tooltip\" title =\"Nächste Seite\"></span>",
						"sLast":     	"Letzte"    
					},
					"oAria": {
						"sSortAscending":  ": aktivieren, um Spalte aufsteigend zu sortieren",
						"sSortDescending": ": aktivieren, um Spalte absteigend zu sortieren"
					}
				
			},


			
			

			"columns" : [ 
				{"data" : "Name"},
				{"data" : "Autor"},
				{"data" : "UploadDatum"},
				{"data" : "DokumentDatum"},
				{"data" : "Download"},
				{"data" : "Delete"}
			

			],
			

	        "columnDefs": [ {
	        	"targets": -2,
	            "data": "null",
	            "defaultContent": "<button class=\"downloadbutton btn-link btn-datatable\" data-toggle=\"tooltip\" title =\"Hier klicken zum Downloaden\"><span class=\"glyphicon glyphicon-arrow-down\" ></span></button>"
	        }, {
	            "targets": -1,
	            "data": "null",
	            "defaultContent": "<button class=\"deletebutton btn-link btn-datatable\" data-toggle=\"tooltip\" title =\"Hier klicken zum Löschen\"><span class=\"glyphicon glyphicon-remove\" ></span></button>"
	        }  ],

	        

	        
	        
			
			
		    initComplete : function() {		// wird aufgerufen, wenn der DataTable fertig geladen ist
		        var input = $('#datatable_wrapper .dataTables_filter input').off(), //Löscht alle existierenden Listener von der Inputbox
		           self = this.api(),			// referenziert den DataTable in eine Variable, damit er innerhalb der Suchen - Funktion aufgerufen werden kann
		            $searchbutton = $('<button class=\"btn-success dttopbtn\" data-toggle=\"tooltip\" title =\"Suchen\">')	//erstellt ein Buttonobjekt
		                       .html('<span class="glyphicon glyphicon-search"/>')		// Button - Text: Suchen
		                       .click(function() {	//Funktion welche bei drücken des Buttons aufgerufen wird
		                        self.search(input.val()).draw();	//ruft die Search - Funktion des DataTables auf und aktualisiert
		                       }),
		            $deletebutton = $('<button class=\"btn-danger dttopbtn\"data-toggle=\"tooltip\" title =\"Löschen\">')	//erstellt ein Buttonobjekt
		                       .html('<span class="glyphicon glyphicon-remove"></span>')		//Button - Text: Löschen
		                       .click(function() {	//Funktion welche bei drücken des Buttons aufgerufen wird
		                          input.val('');	//Setzt den Input wieder leer
		                          $searchbutton.click(); 	//Betätigt die searchbutton - funktion, jetzt jedoch mit leerem Inhalt, zum Aktualisieren
		                       }) 
		        $('#datatable_wrapper .dataTables_filter').append($searchbutton, $deletebutton);	//Fügt beide Buttons zum DataTable hinzu
		    },
			
			

		});

	    $('.table tbody').on( 'click', '.downloadbutton', function () {
	    	console.log("downloadbutton geklickt");

	    	var position = $(this).parents("td");
	    	console.log(position);
	    	var y = $("<div class='animate'>Download</div>");
	    	position.append(y);
            y.animate({
				left: "-100px",
				bottom: "-100px"
            });
            setTimeout(function () {
				y.remove();
            },5000);

            
            var data = table.row( $(this).parents("tr")).data();
	         var str = JSON.stringify(data);
		     	var xhttp = new XMLHttpRequest();
			
	     	xhttp.open("POST", "DownloadServlet", true);
	    	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	    	xhttp.send("download="+str);
	         

	    	
	    });
	    
        
	    
	    
	    $(".table tbody").on("click",".deletebutton",function(){
            var info2 = $(this).parents(".table").attr("id");
        //aktuell primitiv gehardcoded,eventuell switch änderung. Je nach anzahl an tabellen    
            if(info2 === "datatable"){
                    var data = table.row( $(this).parents("tr")).data();
            }
            else{
                if(info2 === "datatable2"){
                      var data = table2.row( $(this).parents("tr")).data();
                }
                else{
                    console.log("SCHWERER FEHLER !")
                }
            }
            
	    //    var data = table.row( $(this).parents("tr")).data();
	        var str = JSON.stringify(data);
            var sourcetable = JSON.stringify(info2);
	        console.log(str);
	     	var xhttp = new XMLHttpRequest();
	    	xhttp.open("POST","DeleteServlet",true);
	    	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	    	xhttp.send("todelete="+str+sourcetable);
            
	    	table.draw();
            table2.draw();
	    });
		
	    
	    	$(".table tbody").on('mouseenter','.glyphicon-arrow-down',function(){
	    		console.log("enter");
	    		$(this).addClass("iconeffect");

	    	});
	    	


		
 		$(".table tbody").on("webkitAnimationEnd mozAnimationEnd animationEnd",".glyphicon-arrow-down",function(){
			console.log("called");
			$(this).removeClass("iconeffect");
		}); 
		
		
		

		console.log("finished  js init");
	});
	



	
</script>
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">EasyPDF</a>
    </div>
    <ul class="nav navbar-nav">
      <li><a href="#">Gelöschte Dokumente</a></li>
      <li><a href="#">Verlauf</a></li>
      <li><a href="#">Über EasyPDF</a></li>
    </ul>
     <ul class="nav navbar-nav navbar-right">
      <li><a href="#"><span class="glyphicon glyphicon-log-out"></span> Abmelden</a></li>
    </ul>
  </div>
</nav>
	<div class="container">
	
	
		<div class="row">
			<div class="col-md-2 col-xs-0 col-lg-1"></div>
			<div class="col-md-8 col-xs-12 col-lg-10">
			<h1 class="text-center">Meine Dokumente</h1>
				<table id="datatable" class="table table-striped table-bordered" cellspacing="0" width="100%">
					<thead>
						<tr>
							<th>Name</th>
							<th>Autor</th>
							<th>UploadDatum</th>
							<th>DokumentDatum</th>
							<th>Download</th>
							<th>Delete</th>
						</tr>

					</thead>
					<tbody>

					</tbody>
				</table>
                
                
			</div>
			<div class="col-md-2 col-xs-0 col-lg-1"></div>
		</div>
        
        <div class="row">
        <div class="col-xs-0 col-md-2 col-lg-1"></div>
            <div class="col-xs-12 col-md-8 col-lg-10">
            			<h1 class="text-center">Zuletzt verwendet</h1>
                <table id="datatable2" class="table table-striped table-bordered" cellspacing="0" width="100%">
					<thead>
						<tr>
							<th>Name</th>
							<th>Autor</th>
							<th>UploadDatum</th>
							<th>DokumentDatum</th>
							<th>Download</th>
							<th>Delete</th>
						</tr>

					</thead>
					<tbody>


					</tbody>
				</table>
            </div>
                    <div class="col-xs-0 col-md-2 col-lg-1"></div>

        </div>

	</div>




</body>
</html>